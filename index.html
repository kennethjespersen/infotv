<!DOCTYPE html>
<html lang="da">
<head>
<meta charset="UTF-8">
<title>Infoskærm</title>
<link rel="stylesheet" href="style.css">
<style>
  body { background:#222; color:white; font-family: Arial, sans-serif; }
  header img { height:100px; width:auto; }

  #top-right-weather {
    position:absolute;
    top:20px;
    right:20px;
    text-align:right;
    padding:0;
    min-width:200px;
  }
  #top-right-weather p { margin:2px 0; }
  #top-right-weather .weatherwidget-io { width:220px; display:block; margin:0 auto; }

  .container { margin-top:120px; padding:20px; }
  table { width:100%; border-collapse: collapse; }
  th, td { border:1px solid #fff; padding:5px; text-align:left; }

  #nyheder { margin-top:20px; height:150px; overflow:hidden; border:1px solid #fff; padding:10px; }
  #nyheder p { margin:5px 0; }
</style>
</head>
<body>
<header>
  <img src="logo.svg" alt="Logo">
</header>

<!-- Øverste højre hjørne: klokke + vejr -->
<div id="top-right-weather">
  <p id="clock">Indlæser klokke...</p>
  <a class="weatherwidget-io" 
     href="https://forecast7.com/en/55d50n9d33/lunderskov/" 
     data-label_1="LUNDERSKOV" 
     data-label_2="VEJR" 
     data-theme="dark">
     LUNDERSKOV VEJR
  </a>
</div>

<div class="container">
  <!-- Ordreoversigt -->
  <section id="ordreoversigt">
    <h2>Ordreoversigt</h2>
    <table id="schedule">
      <thead>
        <tr>
          <th>Ordrenummer</th>
          <th>Beskrivelse</th>
          <th>Kunde</th>
          <th>Ansvarlig</th>
          <th>Leveringsdato</th>
          <th>Klar</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>

  <!-- Nyheder -->
  <div id="nyheder-wrapper">
    <h2>Nyheder</h2>
    <div id="nyheder">Indlæser nyheder...</div>
  </div>
</div>

<script>
const SHEET_ID = "1oZCqUjYE54ePWnpYqARtklEBBq1wwl3dKOyF2TmcCtU";

// --- Live dato og klokke ---
function updateClock() {
  const now = new Date();
  const options = { weekday:'short', day:'2-digit', month:'short', year:'numeric' };
  const date = now.toLocaleDateString('da-DK', options);
  const time = now.toLocaleTimeString('da-DK', { hour:'2-digit', minute:'2-digit', second:'2-digit' });
  document.getElementById("clock").innerText = `${date} | ${time}`;
}
updateClock();
setInterval(updateClock, 1000);

// --- Hent Google Sheets JSON ---
async function fetchSheet(sheetName) {
  try {
    const url = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=${sheetName}`;
    const res = await fetch(url);
    const text = await res.text();
    const json = JSON.parse(text.substring(47, text.length - 2));
    return json.table.rows.map(r => r.c.map(c => (c ? c.v : "")));
  } catch(err) {
    console.error(`Kan ikke hente arket ${sheetName}:`, err);
    return [];
  }
}

// --- Opdater ordreoversigt ---
async function updateOrders() {
  const rows = await fetchSheet("Ordreoversigt");
  const tbody = document.querySelector("#schedule tbody");
  tbody.innerHTML = "";
  rows.forEach(r => {
    if(r[0]) { // mindst første kolonne
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${r[0]||""}</td>
        <td>${r[1]||""}</td>
        <td>${r[2]||""}</td>
        <td>${r[3]||""}</td>
        <td>${r[4]||""}</td>
        <td>${r[5]||""}</td>
      `;
      tbody.appendChild(tr);
    }
  });
}

// --- Opdater nyheder ---
async function updateNews() {
  const rows = await fetchSheet("Nyheder");
  const nyhederDiv = document.getElementById("nyheder");
  if(rows.length>0){
    nyhederDiv.innerHTML = rows.map(r => `<p>${r[0]}</p>`).join("");
  } else {
    nyhederDiv.innerText = "Kan ikke indlæse nyheder.";
  }
}

// --- Kør alt efter DOM er klar ---
document.addEventListener("DOMContentLoaded", () => {
  updateOrders();
  updateNews();
  setInterval(() => { updateOrders(); updateNews(); }, 120000);
});

// --- Weatherwidget.io script ---
!function(d,s,id){
  var js,fjs=d.getElementsByTagName(s)[0];
  if(!d.getElementById(id)){
    js=d.createElement(s);js.id=id;
    js.src='https://weatherwidget.io/js/widget.min.js';
    fjs.parentNode.insertBefore(js,fjs);
  }
}(document,'script','weatherwidget-io-js');
</script>
</body>
</html>
